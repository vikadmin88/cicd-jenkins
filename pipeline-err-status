pipeline {
    agent any

    triggers {
        // Schedule the job to run every 10 minutes
        cron('H/15 * * * *')
    }

    stages {
        stage('Check Apache Logs') {
            steps {
                script {
                    // Define the log file path
                    def logFile = ''
                    def logFileDeb = '/var/log/apache2/access.log'
                    def logFileRhn = '/var/log/httpd/access_log'

                    // Check for 4xx and 5xx errors
                    sh """
                        if [ -f ${logFileDeb} ]; then
                            logFile=${logFileDeb}
                        elif [ -f ${logFileRhn} ]; then
                            logFile=${logFileRhn}
                        else
                            echo "Log file does not exist!"
                            exit 1
                        fi
                        
                        echo "Checking for 4xx and 5xx errors in ${logFile}..."
                        grep -E '" [45][0-9]{2} ' ${logFile} || echo "No 4xx/5xx errors found."
                    """
                }
            }
        }
    }
}
